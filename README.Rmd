---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "50%"
)
```

# simbased

<!-- badges: start -->
<!-- badges: end -->

`simbased` implements simulation-based inference as an alternative to the delta method for computing functions of model parameters, such as marginal effects.

## Installation

You can install the development version of simbased from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("ngreifer/simbased")
```

## Example

Below is an example of performing g-computation for the ATT after logistic regression to compute the marginal risk ratio and its confidence interval:

```{r example}
library(simbased)

data("lalonde", package = "MatchIt")

fit <- glm(I(re78 == 0) ~ treat * (age + educ + race + married + nodegree + re74 + re75),
           data = lalonde, family = binomial)

set.seed(123)
sim_coefs <- sim(fit)

sim_est <- sim_apply(sim_coefs, function(fit) {
  d <- subset(lalonde, treat == 1)
  d$treat <- 1
  p1 <- mean(predict(fit, newdata = d, type = "response"))
  d$treat <- 0
  p0 <- mean(predict(fit, newdata = d, type = "response"))
  c(RR = p1 / p0)
}, verbose = FALSE)

summary(sim_est)
sim_plot(sim_est)
```

We could have used `marginaleffects`, which uses the delta method instead:

```{r}
marginaleffects::comparisons(fit, variables = list(treat = 0:1),
                             newdata = subset(lalonde, treat == 1),
                             transform_pre = "lnratioavg") |>
  summary(transform_avg = exp)
```

The simulation-based confidence intervals are a bit wider, reflecting that the delta method may be a poor approximation.
