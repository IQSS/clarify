<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Plotting and inference for clarify_est objects — plot.clarify_est • clarify</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plotting and inference for clarify_est objects — plot.clarify_est"><meta name="description" content='summary() tabulates the estimates and confidence intervals and (optionally) p-values from a clarify_est object. confint() computes confidence intervals. plot() plots the "posterior" distribution of estimates.'><meta property="og:description" content='summary() tabulates the estimates and confidence intervals and (optionally) p-values from a clarify_est object. confint() computes confidence intervals. plot() plots the "posterior" distribution of estimates.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">clarify</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/clarify.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Zelig.html">Translating Zelig to clarify</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/iqss/clarify/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Plotting and inference for <code>clarify_est</code> objects</h1>
      <small class="dont-index">Source: <a href="https://github.com/iqss/clarify/blob/main/R/plot.clarify_est.R" class="external-link"><code>R/plot.clarify_est.R</code></a>, <a href="https://github.com/iqss/clarify/blob/main/R/summary.clarify_est.R" class="external-link"><code>R/summary.clarify_est.R</code></a></small>
      <div class="d-none name"><code>summary.clarify_est.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> tabulates the estimates and confidence intervals and (optionally) p-values from a <code>clarify_est</code> object. <code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code> computes confidence intervals. <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> plots the "posterior" distribution of estimates.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'clarify_est'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">parm</span>,</span>
<span>  ci <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>  reference <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  simultaneous <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'clarify_est'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">parm</span>,</span>
<span>  level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>  null <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  simultaneous <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'clarify_est'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">parm</span>,</span>
<span>  level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>  simultaneous <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-parm">parm<a class="anchor" aria-label="anchor" href="#arg-parm"></a></dt>
<dd><p>a vector of the names or indices of the estimates to plot. If unspecified, all estimates will be displayed.</p></dd>


<dt id="arg-ci">ci<a class="anchor" aria-label="anchor" href="#arg-ci"></a></dt>
<dd><p><code>logical</code>; whether to display confidence interval limits for the estimates. Default is <code>TRUE</code>.</p></dd>


<dt id="arg-level">level<a class="anchor" aria-label="anchor" href="#arg-level"></a></dt>
<dd><p>the confidence level desired. Default is .95 for 95% confidence intervals.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>the method used to compute p-values and confidence intervals. Can be <code>"wald"</code> to use a Normal approximation or <code>"quantile"</code> to use the simulated sampling distribution (default). See Details. Abbreviations allowed.</p></dd>


<dt id="arg-reference">reference<a class="anchor" aria-label="anchor" href="#arg-reference"></a></dt>
<dd><p><code>logical</code>; whether to overlay a normal density reference distribution over the plots. Default is <code>FALSE</code>.</p></dd>


<dt id="arg-ncol">ncol<a class="anchor" aria-label="anchor" href="#arg-ncol"></a></dt>
<dd><p>the number of columns used when wrapping multiple plots; default is 3.</p></dd>


<dt id="arg-simultaneous">simultaneous<a class="anchor" aria-label="anchor" href="#arg-simultaneous"></a></dt>
<dd><p><code>logical</code>; whether confidence intervals and p-values should be simultaneous or not (i.e., adjusted for multiple comparisons); default is <code>FALSE</code>. See Details.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>for <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, further arguments passed to <code><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">ggplot2::geom_density()</a></code>.</p></dd>


<dt id="arg-object-x">object, x<a class="anchor" aria-label="anchor" href="#arg-object-x"></a></dt>
<dd><p>a <code>clarify_est</code> object; the output of a call to <code><a href="sim_apply.html">sim_apply()</a></code> or its wrappers.</p></dd>


<dt id="arg-null">null<a class="anchor" aria-label="anchor" href="#arg-null"></a></dt>
<dd><p>the values of the parameters under the null hypothesis for the p-value calculations. Should have length equal to the number of quantities estimated, or one, in which case it will be recycled, or it can be a named vector with just the names of quantities for which null values are to be set. Set values to <code>NA</code> to omit p-values for those quantities. When all values are <code>NA</code>, the default, no p-values are produced.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, a <code>summary.clarify_est</code> object, which is a matrix containing the coefficient estimates, standard errors, test statistics, p-values, and confidence intervals. Not all columns will be present depending on the arguments supplied to <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>.</p>
<p>For <code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code>, a matrix containing the confidence intervals for the requested quantities.</p>
<p>For <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, a <code>ggplot</code> object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> uses the estimates computed from the original model as its estimates and uses the simulated parameters for inference only, in line with the recommendations of Rainey (2023).</p>
<p>When <code>method = "wald"</code>, the standard deviation of the simulation estimates is used as the standard error, which is used in the z-statistics and the confidence intervals. The p-values and confidence intervals are valid only when the sampling distribution of the resulting statistic is normal (which can be assessed using <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>). When <code>method = "quantile"</code>, the confidence interval is calculated using the quantiles of the simulation estimates corresponding to <code>level</code>, and the p-value is calculated as twice the proportion of simulation estimates less than or greater than <code>null</code>, whichever is smaller; this is equivalent to inverting the confidence interval but is only truly valid when the true sampling distribution is only a location shift from the sampling distribution under the null hypothesis and should therefore be interpreted with caution. Using <code>"method = "quantile"</code> (the default) is recommended because the confidence intervals will be valid even if the sampling distribution is not Normally distributed. The precision of the p-values and confidence intervals depends on the number of simulations requested (the value of <code>n</code> supplied to <code><a href="sim.html">sim()</a></code>).</p>
<p>When <code>simultaneous = TRUE</code>, confidence intervals and p-values are adjusted to account for multiple comparisons using the "sup-t" confidence region and its inversion. The sup-t confidence region is the smallest rectangular region that ensures simultaneous coverage of all parameters at the desired confidence level. It is found by adjusting the nominal confidence level until a new level is found that, when simultaneously applied to all estimates, yields intervals that contain all estimates with rates equal to the original level. Unlike some other adjustments for multiple comparisons (e.g., Holm, Bonferroni, Benjamini-Hochberg), this method takes into account the joint distribution of the estimates, often yielding narrower regions that are less conservative (but still valid). P-values are found by finding the level of the narrowest band that guarantees simultaneous coverage while containing the null value of the given parameter. When <code>method = "quantile"</code>, the Bayesian algorithm described by Montiel Olea and Plagborg-Møller (2019) is used with the simulated estimates; when <code>method = "wald"</code>, a new simulation is performed treating the estimates as coming from a multivariate normal distribution.</p>
<p>The plots are produced using <code><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">ggplot2::geom_density()</a></code> and can be customized with <span class="pkg">ggplot2</span> functions. When <code>reference = TRUE</code>, a reference Normal distribution is produced using the empirical mean and standard deviation of the simulated values. A blue references line is plotted at the median of the simulated values. For Wald-based inference to be valid, the reference distribution should overlap with the empirical distribution, in which case the quantile-based and Wald-based intervals should be similar. For quantile-based inference to be valid, the median of the estimates should overlap with the estimated value; this is a necessary but not sufficient condition, though.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Montiel Olea, J. L., &amp; Plagborg-Møller, M. (2019). Simultaneous confidence bands: Theory, implementation, and an application to SVARs. <em>Journal of Applied Econometrics</em>, 34(1), 1–17. <a href="https://doi.org/10.1002/jae.2656" class="external-link">doi:10.1002/jae.2656</a></p>
<p>Rainey, C. (2023). A careful consideration of CLARIFY: Simulation-induced bias in point estimates of quantities of interest. <em>Political Science Research and Methods</em>, 1–10. <a href="https://doi.org/10.1017/psrm.2023.8" class="external-link">doi:10.1017/psrm.2023.8</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><code><a href="sim_apply.html">sim_apply()</a></code> for applying a function to each set of simulated coefficients</p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"MatchIt"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">re78</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>,</span></span>
<span class="r-in"><span>          data <span class="op">=</span> <span class="va">lalonde</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim.html">sim</a></span><span class="op">(</span><span class="va">fit</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute average marginal means for `treat`</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_ame.html">sim_ame</a></span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"treat"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   E[Y(0)]   E[Y(1)] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.7453346 0.8175754 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute average marginal effects on risk difference</span></span></span>
<span class="r-in"><span><span class="co"># (RD) and risk ratio (RR) scale</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">est</span>,</span></span>
<span class="r-in"><span>                 RD <span class="op">=</span> <span class="va">`E[Y(1)]`</span> <span class="op">-</span> <span class="va">`E[Y(0)]`</span>,</span></span>
<span class="r-in"><span>                 RR <span class="op">=</span> <span class="va">`E[Y(1)]`</span> <span class="op">/</span> <span class="va">`E[Y(0)]`</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute confidence intervals and p-values,</span></span></span>
<span class="r-in"><span><span class="co"># using given null values for computing p-values</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span>, null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`RD` <span class="op">=</span> <span class="fl">0</span>, `RR` <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Estimate   2.5 %  97.5 % P-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(0)]   0.7453  0.6947  0.8243       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(1)]   0.8176  0.7340  0.9035       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RD        0.0722 -0.0345  0.1791    0.16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RR        1.0969  0.9569  1.2478    0.16</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Same tests using normal approximation and alternate</span></span></span>
<span class="r-in"><span><span class="co"># syntax for `null`</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span>, null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        normal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Estimate   2.5 %  97.5 % P-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(0)]   0.7453  0.6947  0.8243       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(1)]   0.8176  0.7340  0.9035       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RD        0.0722 -0.0345  0.1791    0.16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RR        1.0969  0.9569  1.2478    0.16</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the RD and RR with a reference distribution</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est</span>, parm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RD"</span>, <span class="st">"RR"</span><span class="op">)</span>, reference <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>     ci <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="summary.clarify_est-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the RD and RR with quantile confidence bounds</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est</span>, parm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RD"</span>, <span class="st">"RR"</span><span class="op">)</span>, ci <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="summary.clarify_est-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer, Steven Worthington, Stefano Iacus, Gary King.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

