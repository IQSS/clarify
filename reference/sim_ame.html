<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="sim_ame() is a wrapper for sim_apply() that computes average marginal effects, the average effect of changing a single variable from one value to another (i.e., from one category to another for categorical variables or a tiny change for continuous variables)."><title>Compute average marginal effects — sim_ame • clarify</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute average marginal effects — sim_ame"><meta property="og:description" content="sim_ame() is a wrapper for sim_apply() that computes average marginal effects, the average effect of changing a single variable from one value to another (i.e., from one category to another for categorical variables or a tiny change for continuous variables)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">clarify</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/clarify.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Zelig.html">Translating Zelig to clarify</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/iqss/clarify/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Compute average marginal effects</h1>
      <small class="dont-index">Source: <a href="https://github.com/iqss/clarify/blob/HEAD/R/sim_ame.R" class="external-link"><code>R/sim_ame.R</code></a></small>
      <div class="d-none name"><code>sim_ame.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>sim_ame()</code> is a wrapper for <code><a href="sim_apply.html">sim_apply()</a></code> that computes average marginal effects, the average effect of changing a single variable from one value to another (i.e., from one category to another for categorical variables or a tiny change for continuous variables).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sim_ame</span><span class="op">(</span></span>
<span>  <span class="va">sim</span>,</span>
<span>  <span class="va">var</span>,</span>
<span>  subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  contrast <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outcome <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  eps <span class="op">=</span> <span class="fl">1e-05</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cl <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for clarify_ame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, digits <span class="op">=</span> <span class="cn">NULL</span>, max.ests <span class="op">=</span> <span class="fl">6</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>sim</dt>
<dd><p>a <code>clarify_sim</code> object; the output of a call to <code><a href="sim.html">sim()</a></code> or
<code><a href="misim.html">misim()</a></code>.</p></dd>


<dt>var</dt>
<dd><p>either the name of a variable for which marginal effects are to be computed or a named list of length one containing the values the variable should take. If a list is supplied or the named variables is categorical (factor, character, or having two values), categorical calculations will be triggered. Otherwise, continuous calculations will be triggered. See Details.</p></dd>


<dt>subset</dt>
<dd><p>optional; a vector used to subset the data used to compute the marginal effects. This will be evaluated within the original dataset used to fit the model using <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code>, so nonstandard evaluation is allowed.</p></dd>


<dt>by</dt>
<dd><p>a one-sided formula or character vector containing the names of variables for which to stratify the estimates. Each quantity will be computed within each level of the complete cross of the variables specified in <code>by</code>.</p></dd>


<dt>contrast</dt>
<dd><p>a string containing the name of a contrast between the average marginal means when the variable named in <code>var</code> is categorical and takes on two values. Allowed options include <code>"diff"</code> for the difference in means (also <code>"rd"</code>), <code>"rr"</code> for the risk ratio (also <code>"irr"</code>), <code>"log(rr):</code> for the log risk ratio (also <code>"log(irr)"</code>), <code>"sr"</code> for the survival ratio, <code>"log(sr):</code> for the log survival ratio, <code>"srr"</code> for the switch relative risk (also <code>"grrr"</code>), <code>"or"</code> for the odds ratio, <code>"log(or)"</code> for the log odds ratio, and <code>"nnt"</code> for the number needed to treat. These options are not case sensitive, but the parentheses must be included if present.</p></dd>


<dt>outcome</dt>
<dd><p>a string containing the name of the outcome or outcome level for multivariate (multiple outcomes) or multi-category outcomes. Ignored for univariate (single outcome) and binary outcomes.</p></dd>


<dt>type</dt>
<dd><p>a string containing the type of predicted values (e.g., the link or the response). Passed to <code><a href="https://rdrr.io/pkg/marginaleffects/man/get_predict.html" class="external-link">marginaleffects::get_predict()</a></code> and eventually to <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> in most cases. The default and allowable option depend on the type of model supplied, but almost always corresponds to the response scale (e.g., predicted probabilities for binomial models).</p></dd>


<dt>eps</dt>
<dd><p>when the variable named in <code>var</code> is continuous, the value by which to change the variable values to approximate the derivative. See Details.</p></dd>


<dt>verbose</dt>
<dd><p><code>logical</code>; whether to display a text progress bar indicating
progress and estimated time remaining for the procedure. Default is <code>TRUE</code>.</p></dd>


<dt>cl</dt>
<dd><p>a cluster object created by <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">parallel::makeCluster()</a></code>, or an
integer to indicate the number of child-processes (integer values are
ignored on Windows) for parallel evaluations. See <code><a href="https://rdrr.io/pkg/pbapply/man/pbapply.html" class="external-link">pbapply::pblapply()</a></code> for
details. If <code>NULL</code>, no parallelization will take place.</p></dd>


<dt>x</dt>
<dd><p>a <code>clarify_ame</code> object.</p></dd>


<dt>digits</dt>
<dd><p>the minimum number of significant digits to be used; passed to <code><a href="https://rdrr.io/r/base/print.dataframe.html" class="external-link">print.data.frame()</a></code>.</p></dd>


<dt>max.ests</dt>
<dd><p>the maximum number of estimates to display.</p></dd>


<dt>...</dt>
<dd><p>optional arguments passed to <code>FUN</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <code>clarify_ame</code> object, which inherits from <code>clarify_est</code> and is similar to
the output of <code><a href="sim_apply.html">sim_apply()</a></code>, with the additional attributes <code>"var"</code> containing
the variable named in <code>var</code> and <code>"by"</code> containing the names of the variables specified in <code>by</code> (if any). The average adjusted predictions will be named
<code>E[Y({v})]</code>, where <code>{v}</code> is replaced with the values the focal variable
(<code>var</code>) takes on. The average marginal effect for a continuous <code>var</code> will be
named <code>E[dY/d({x})]</code> where <code>{x}</code> is replaced with <code>var</code>. When <code>by</code> is specified, the average adjusted predictions will be named <code>E[Y({v})|{b}]</code> and the average marginel effect <code>E[dY/d({x})|{b}]</code> where <code>{b}</code> is a comma-separated list of of values of the <code>by</code> variables at which the quantity is computed. See examples.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>sim_ame()</code> operates differently depending on whether continuous or categorical calculations are triggered. To trigger categorical calculations, <code>var</code> should be a string naming a factor, character, or binary variable or a named list with specific values given (e.g., <code>var = list(x1 = c(1, 2 ,3))</code>). Otherwise, continuous calculations are triggered.</p>
<p>Categorical calculations involve computing average marginal means at each level of <code>var</code>. The average marginal mean is the average predicted outcome value after setting all units' value of <code>var</code> to one level. (This quantity has several names, including the average potential outcome, average adjusted prediction, and standardized mean). When <code>var</code> only takes on two levels (or it is supplied as a list and only two values are specified), a contrast between the average marginal means can be computed by supplying an argument to <code>contrast</code>. Contrasts can be manually computed using <code><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform()</a></code> afterward as well.</p>
<p>Continuous calculations involve computing the average of marginal effects of <code>var</code> across units. A marginal effect is the instantaneous rate of change corresponding to changing a unit's observed value of <code>var</code> by a tiny amount and considering to what degree the predicted outcome changes. The ratio of the change in the predicted outcome to the change in the value of <code>var</code> is the marginal effect; these are averaged across the sample to arrive at an average marginal effect. The "tiny amount" used is <code>eps</code> times the standard deviation of the focal variable.</p>
<p>If unit-level weights are included in the model fit (and discoverable using <code><a href="https://easystats.github.io/insight/reference/get_weights.html" class="external-link">insight::get_weights()</a></code>), all means will be computed as weighted means.</p><div class="section">
<h3 id="effect-measures">Effect measures<a class="anchor" aria-label="anchor" href="#effect-measures"></a></h3>


<p>The effect measures specified in <code>contrast</code> are defined below. Typically only <code>"diff"</code> is appropriate for continuous outcomes and <code>"diff"</code> or <code>"irr"</code> are appropriate for count outcomes; the rest are appropriate for binary outcomes. For a focal variable with two levels, <code>0</code> and <code>1</code>, and an outcome <code>Y</code>, the average marginal means will be denoted in the below formulas as <code>E[Y(0)]</code> and <code>E[Y(1)]</code>, respectively.</p><table class="table table"><tr><td><code>contrast</code></td><td>Formula</td></tr><tr><td><code>"diff"</code></td><td><code>E[Y(1)] - E[Y(0)]</code></td></tr><tr><td><code>"rr"</code></td><td><code>E[Y(1)] / E[Y(0)]</code></td></tr><tr><td><code>"sr"</code></td><td><code>(1 - E[Y(1)]) / (1 - E[Y(0)])</code></td></tr><tr><td><code>"srr"</code></td><td><code>1 - sr</code> if  <code>E[Y(1)] &gt; E[Y(0)]</code></td></tr><tr><td></td><td><code>rr - 1</code> if <code>E[Y(1)] &lt; E[Y(0)]</code></td></tr><tr><td></td><td><code>0</code> otherwise</td></tr><tr><td><code>"or"</code></td><td><code>O[Y(1)] / O[Y(0)]</code></td></tr><tr><td></td><td>where <code>O[Y(.)]</code> = <code>E[Y(.)] / (1 - E[Y(.)])</code></td></tr><tr><td><code>"nnt"</code></td><td><code>1 / (E[Y(1)] - E[Y(0)])</code></td></tr></table><p>The <code>log(.)</code> versions are defined by taking the <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code> (natural log) of the corresponding effect measure.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="sim_apply.html">sim_apply()</a></code>, which provides a general interface to computing any
quantities for simulation-based inference; <code><a href="summary.clarify_est.html">plot.clarify_est()</a></code> for plotting the
output of a call to <code>sim_ame()</code>; <code><a href="summary.clarify_est.html">summary.clarify_est()</a></code> for computing
p-values and confidence intervals for the estimated quantities.</p>
<p><code><a href="https://rdrr.io/pkg/marginaleffects/man/marginaleffects.html" class="external-link">marginaleffects::marginaleffects()</a></code>, <code><a href="https://rdrr.io/pkg/marginaleffects/man/comparisons.html" class="external-link">marginaleffects::comparisons()</a></code>, and <code>margins::margins()</code> for delta method-based implementations of computing average marginal effects.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"MatchIt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit the model</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">re78</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span></span></span>
<span class="r-in"><span>             <span class="va">married</span> <span class="op">+</span> <span class="va">re74</span>,</span></span>
<span class="r-in"><span>           data <span class="op">=</span> <span class="va">lalonde</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate coefficients</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim.html">sim</a></span><span class="op">(</span><span class="va">fit</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Average marginal effect of `age`</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"age"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate    2.5 %   97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)] -0.00695 -0.01013 -0.00442</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Contrast between average adjusted predictions</span></span></span>
<span class="r-in"><span><span class="co"># for `treat`</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"treat"</span>, contrast <span class="op">=</span> <span class="st">"rr"</span>,</span></span>
<span class="r-in"><span>               verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Estimate 2.5 % 97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(0)]    0.743 0.701  0.781</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(1)]    0.810 0.758  0.858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RR         1.090 1.000  1.185</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Average adjusted predictions for `race`; need to follow up</span></span></span>
<span class="r-in"><span><span class="co"># with contrasts for specific levels</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"race"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">est</span>,</span></span>
<span class="r-in"><span>                 `RR(h,b)` <span class="op">=</span> <span class="va">`E[Y(hispan)]`</span> <span class="op">/</span> <span class="va">`E[Y(black)]`</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate 2.5 % 97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(black)]     0.706 0.646  0.758</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(hispan)]    0.832 0.741  0.898</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(white)]     0.800 0.751  0.847</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RR(h,b)         1.178 1.029  1.331</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Average adjusted predictions for `treat` within levels of</span></span></span>
<span class="r-in"><span><span class="co"># `married`, first using `subset` and then using `by`</span></span></span>
<span class="r-in"><span><span class="va">est0</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"treat"</span>, subset <span class="op">=</span> <span class="va">married</span> <span class="op">==</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                contrast <span class="op">=</span> <span class="st">"rd"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est0</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est0</span><span class="op">)</span>, <span class="st">"|married=0"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">est1</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"treat"</span>, subset <span class="op">=</span> <span class="va">married</span> <span class="op">==</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                contrast <span class="op">=</span> <span class="st">"rd"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est1</span><span class="op">)</span>, <span class="st">"|married=1"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">est0</span>, <span class="va">est1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    Estimate     2.5 %    97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(0)]|married=0  7.24e-01  6.58e-01  7.79e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(1)]|married=0  7.95e-01  7.42e-01  8.43e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RD|married=0       7.11e-02 -2.65e-04  1.47e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(0)]|married=1  7.70e-01  7.21e-01  8.17e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(1)]|married=1  8.31e-01  7.55e-01  8.94e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RD|married=1       6.10e-02 -4.39e-05  1.16e-01</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"treat"</span>, by <span class="op">=</span> <span class="op">~</span><span class="va">married</span>,</span></span>
<span class="r-in"><span>               contrast <span class="op">=</span> <span class="st">"rd"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">est</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A `clarify_est` object (from `sim_ame()`)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Average marginal effect of `treat`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    - within levels of `married`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - 100 simulated values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - 6 quantities estimated:                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[Y(0)|0] 0.72405662</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[Y(1)|0] 0.79518774</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  RD[0]     0.07113112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[Y(0)|1] 0.76974375</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[Y(1)|1] 0.83078255</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  RD[1]     0.06103880</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Estimate     2.5 %    97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(0)|0]  7.24e-01  6.58e-01  7.79e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(1)|0]  7.95e-01  7.42e-01  8.43e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RD[0]      7.11e-02 -2.65e-04  1.47e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(0)|1]  7.70e-01  7.21e-01  8.17e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(1)|1]  8.31e-01  7.55e-01  8.94e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RD[1]      6.10e-02 -4.39e-05  1.16e-01</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Average marginal effect of `re74` within levels of</span></span></span>
<span class="r-in"><span><span class="co"># married*race</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"age"</span>, by <span class="op">=</span> <span class="op">~</span><span class="va">married</span> <span class="op">+</span> <span class="va">race</span>,</span></span>
<span class="r-in"><span>               verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">est</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A `clarify_est` object (from `sim_ame()`)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Average marginal effect of `age`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    - within levels of `married` and `race`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - 100 simulated values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - 6 quantities estimated:                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[dY/d(age)|0,black]  -0.007950175</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[dY/d(age)|0,hispan] -0.005599656</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[dY/d(age)|0,white]  -0.006626402</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[dY/d(age)|1,black]  -0.008058486</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[dY/d(age)|1,hispan] -0.005497813</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[dY/d(age)|1,white]  -0.006303652</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span>, null <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       Estimate    2.5 %   97.5 % P-value    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)|0,black]  -0.00795 -0.01171 -0.00530  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)|0,hispan] -0.00560 -0.00988 -0.00281  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)|0,white]  -0.00663 -0.00951 -0.00398  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)|1,black]  -0.00806 -0.01194 -0.00499  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)|1,hispan] -0.00550 -0.00938 -0.00290  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)|1,white]  -0.00630 -0.00942 -0.00380  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Comparing AMEs between married and unmarried for</span></span></span>
<span class="r-in"><span><span class="co"># each level of `race`</span></span></span>
<span class="r-in"><span><span class="va">est_diff</span> <span class="op">&lt;-</span> <span class="va">est</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">-</span> <span class="va">est</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est_diff</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"AME_diff|"</span>, <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">race</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est_diff</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  Estimate     2.5 %    97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AME_diff|black  -0.000108 -0.001290  0.001062</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AME_diff|hispan  0.000102 -0.001386  0.001438</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AME_diff|white   0.000323 -0.001384  0.001580</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Noah Greifer, Steven Worthington, Stefano Iacus, Gary King.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

