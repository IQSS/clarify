<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute average marginal effects — sim_ame • clarify</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute average marginal effects — sim_ame"><meta name="description" content="sim_ame() is a wrapper for sim_apply() that computes average marginal effects, the average effect of changing a single variable from one value to another (i.e., from one category to another for categorical variables or a tiny change for continuous variables)."><meta property="og:description" content="sim_ame() is a wrapper for sim_apply() that computes average marginal effects, the average effect of changing a single variable from one value to another (i.e., from one category to another for categorical variables or a tiny change for continuous variables)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">clarify</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/clarify.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Zelig.html">Translating Zelig to clarify</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/iqss/clarify/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Compute average marginal effects</h1>
      <small class="dont-index">Source: <a href="https://github.com/iqss/clarify/blob/main/R/sim_ame.R" class="external-link"><code>R/sim_ame.R</code></a></small>
      <div class="d-none name"><code>sim_ame.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>sim_ame()</code> is a wrapper for <code><a href="sim_apply.html">sim_apply()</a></code> that computes average marginal effects, the average effect of changing a single variable from one value to another (i.e., from one category to another for categorical variables or a tiny change for continuous variables).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sim_ame</span><span class="op">(</span></span>
<span>  <span class="va">sim</span>,</span>
<span>  <span class="va">var</span>,</span>
<span>  subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  contrast <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outcome <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  eps <span class="op">=</span> <span class="fl">1e-05</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'clarify_ame'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, digits <span class="op">=</span> <span class="fl">4L</span>, max.ests <span class="op">=</span> <span class="fl">6L</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sim">sim<a class="anchor" aria-label="anchor" href="#arg-sim"></a></dt>
<dd><p>a <code>clarify_sim</code> object; the output of a call to <code><a href="sim.html">sim()</a></code> or <code><a href="misim.html">misim()</a></code>.</p></dd>


<dt id="arg-var">var<a class="anchor" aria-label="anchor" href="#arg-var"></a></dt>
<dd><p>either the names of the variables for which marginal effects are to be computed or a named list containing the values the variables should take. See Details.</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>optional; a vector used to subset the data used to compute the marginal effects. This will be evaluated within the original dataset used to fit the model using <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code>, so nonstandard evaluation is allowed.</p></dd>


<dt id="arg-by">by<a class="anchor" aria-label="anchor" href="#arg-by"></a></dt>
<dd><p>a one-sided formula or character vector containing the names of
variables for which to stratify the estimates. Each quantity will be
computed within each level of the complete cross of the variables specified
in <code>by</code>.</p></dd>


<dt id="arg-contrast">contrast<a class="anchor" aria-label="anchor" href="#arg-contrast"></a></dt>
<dd><p>a string containing the name of a contrast between the
average marginal means when the variable named in <code>var</code> is categorical and
takes on two values. Allowed options include <code>"diff"</code> for the difference in
means (also <code>"rd"</code>), <code>"rr"</code> for the risk ratio (also <code>"irr"</code>), <code>"log(rr):</code>
for the log risk ratio (also <code>"log(irr)"</code>), <code>"sr"</code> for the survival ratio,
<code>"log(sr):</code> for the log survival ratio, <code>"srr"</code> for the switch relative
risk (also <code>"grrr"</code>), <code>"or"</code> for the odds ratio, <code>"log(or)"</code> for the log
odds ratio, and <code>"nnt"</code> for the number needed to treat. These options are
not case sensitive, but the parentheses must be included if present.</p></dd>


<dt id="arg-outcome">outcome<a class="anchor" aria-label="anchor" href="#arg-outcome"></a></dt>
<dd><p>a string containing the name of the outcome or outcome level
for multivariate (multiple outcomes) or multi-category outcomes. Ignored
for univariate (single outcome) and binary outcomes.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>a string containing the type of predicted values (e.g., the link
or the response). Passed to <code><a href="https://marginaleffects.com/man/r/get_predict.html" class="external-link">marginaleffects::get_predict()</a></code> and eventually
to <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> in most cases. The default and allowable option depend on
the type of model supplied, but almost always corresponds to the response
scale (e.g., predicted probabilities for binomial models).</p></dd>


<dt id="arg-eps">eps<a class="anchor" aria-label="anchor" href="#arg-eps"></a></dt>
<dd><p>when the variable named in <code>var</code> is continuous, the value by which
to change the variable values to approximate the derivative. See Details.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p><code>logical</code>; whether to display a text progress bar indicating progress and estimated time remaining for the procedure. Default is <code>TRUE</code>.</p></dd>


<dt id="arg-cl">cl<a class="anchor" aria-label="anchor" href="#arg-cl"></a></dt>
<dd><p>a cluster object created by <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">parallel::makeCluster()</a></code>, or an integer to indicate the number of child-processes (integer values are ignored on Windows) for parallel evaluations. See <code><a href="https://peter.solymos.org/pbapply/reference/pbapply.html" class="external-link">pbapply::pblapply()</a></code> for details. If <code>NULL</code>, no parallelization will take place.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>for <code>sim_ame()</code>, additional arguments passed to <code><a href="https://marginaleffects.com/man/r/get_predict.html" class="external-link">marginaleffects::get_predict()</a></code> (and eventually to <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>) to compute predictions. For <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>, ignored.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>a <code>clarify_ame</code> object.</p></dd>


<dt id="arg-digits">digits<a class="anchor" aria-label="anchor" href="#arg-digits"></a></dt>
<dd><p>the minimum number of significant digits to be used; passed to <code><a href="https://rdrr.io/r/base/print.dataframe.html" class="external-link">print.data.frame()</a></code>.</p></dd>


<dt id="arg-max-ests">max.ests<a class="anchor" aria-label="anchor" href="#arg-max-ests"></a></dt>
<dd><p>the maximum number of estimates to display.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>clarify_ame</code> object, which inherits from <code>clarify_est</code> and is
similar to the output of <code><a href="sim_apply.html">sim_apply()</a></code>, with the additional attributes
<code>"var"</code> containing the variable values specified in <code>var</code> and <code>"by"</code> containing the
names of the variables specified in <code>by</code> (if any). The average adjusted
predictions will be named <code>E[Y({v})]</code>, where <code>{v}</code> is replaced with the
values the variables named in <code>var</code> take on. The average marginal effect for a
continuous <code>var</code> will be named <code>E[dY/d({x})]</code> where <code>{x}</code> is replaced with
<code>var</code>. When <code>by</code> is specified, the average adjusted predictions will be named
<code>E[Y({v})|{b}]</code> and the average marginal effect <code>E[dY/d({x})|{b}]</code> where
<code>{b}</code> is a comma-separated list of of values of the <code>by</code> variables at which
the quantity is computed. See examples.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>sim_ame()</code> computes average adjusted predictions or average marginal effects depending on which variables are named in <code>var</code> and how they are specified. Canonically, <code>var</code> should be specified as a named list with the value(s) each variable should be set to. For example, specifying <code>var = list(x1 = 0:1)</code> computes average adjusted predictions setting <code>x1</code> to 0 and 1. Specifying a variable's values as <code>NULL</code>, e.g., <code>list(x1 = NULL)</code>, is equivalent to requesting average adjusted predictions at each unique value of the variable when that variable is binary or a factor or character and requests the average marginal effect of that variable otherwise. Specifying an unnamed entry in the list with a string containing the value of that variable, e.g., <code>list("x1")</code> is equivalent to specifying <code>list(x1 = NULL)</code>. Similarly, supplying a vector with the names of the variables is equivalent to specifying a list, e.g., <code>var = "x1"</code> is equivalent to <code>var = list(x1 = NULL)</code>.</p>
<p>Multiple variables can be supplied to <code>var</code> at the same time to set the corresponding variables to those values. If all values are specified directly or the variables are categorical, e.g., <code>list(x1 = 0:1, x2 = c(5, 10))</code>, this computes average adjusted predictions at each combination of the supplied variables. If any one variable's values is specified as <code>NULL</code> and the variable is continuous, the average marginal effect of that variable will be computed with the other variables set to their corresponding combinations. For example, if <code>x2</code> is a continuous variable, specifying <code>var = list(x1 = 0:1, x2 = NULL)</code> requests the average marginal effect of <code>x2</code> computed first setting <code>x1</code> to 0 and then setting <code>x1</code> to 1. The average marginal effect can only be computed for one variable at a time.</p>
<p>Below are some examples of specifications and what they request, assuming <code>x1</code> is a binary variable taking on values of 0 and 1 and <code>x2</code> is a continuous variable:</p><ul><li><p><code>list(x1 = 0:1)</code>, <code>list(x1 = NULL)</code>, <code>list("x1")</code>, <code>"x1"</code> – the average adjusted predictions setting <code>x1</code> to 0 and to 1</p></li>
<li><p><code>list(x2 = NULL)</code>, <code>list("x2")</code>, <code>"x2"</code> – the average marginal effect of <code>x2</code></p></li>
<li><p><code>list(x2 = c(5, 10))</code> – the average adjusted predictions setting <code>x2</code> to 5 and to 10</p></li>
<li><p><code>list(x1 = 0:1, x2 = c(5, 10))</code>, <code>list("x1", x2 = c(5, 10))</code> – the average adjusted predictions setting <code>x1</code> and <code>x2</code> in a full cross of 0, 1 and 5, 10, respectively (e.g., (0, 5), (0, 10), (1, 5), and (1, 10))</p></li>
<li><p><code>list(x1 = 0:1, "x2")</code>, <code>list("x1", "x2")</code>, <code>c("x1", "x2")</code> – the average marginal effects of <code>x2</code> setting <code>x1</code> to 0 and to 1</p></li>
</ul><p>The average adjusted prediction is the average predicted outcome
value after setting all units' value of a variable to a specified level. (This quantity
has several names, including the average potential outcome, average marginal mean, and standardized mean). When exactly two average adjusted predictions are requested, a contrast
between them can be requested by supplying an argument
to <code>contrast</code> (see Effect Measures section below). Contrasts can be manually computed using <code><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform()</a></code>
afterward as well; this is required when multiple average adjusted predictions are requested (i.e., because a single variable was supplied to <code>var</code> with more than two levels or a combination of multiple variables was supplied).</p>
<p>A marginal effect is the instantaneous rate of change
corresponding to changing a unit's observed value of a variable by a tiny amount
and considering to what degree the predicted outcome changes. The ratio of
the change in the predicted outcome to the change in the value of the variable is
the marginal effect; these are averaged across the sample to arrive at an
average marginal effect. The "tiny amount" used is <code>eps</code> times the standard
deviation of the focal variable.</p>
<p>The difference between using <code>by</code> or <code>subset</code> vs. <code>var</code> is that <code>by</code> and <code>subset</code> subset the data when computing the requested quantity, whereas <code>var</code> sets the corresponding variable to given a value for all units. For example, using <code>by = ~v</code> computes the quantity of interest separately for each subset of the data defined by <code>v</code>, whereas setting <code>var = list(., "v")</code> computes the quantity of interest for all units setting their value of <code>v</code> to its unique values. The resulting quantities have different interpretations. Both <code>by</code> and <code>var</code> can be used simultaneously.</p><div class="section">
<h3 id="effect-measures">Effect measures<a class="anchor" aria-label="anchor" href="#effect-measures"></a></h3>


<p>The effect measures specified in <code>contrast</code> are defined below. Typically only
<code>"diff"</code> is appropriate for continuous outcomes and <code>"diff"</code> or <code>"irr"</code> are
appropriate for count outcomes; the rest are appropriate for binary outcomes.
For a focal variable with two levels, <code>0</code> and <code>1</code>, and an outcome <code>Y</code>, the
average marginal means will be denoted in the below formulas as <code>E[Y(0)]</code> and
<code>E[Y(1)]</code>, respectively.</p><table class="table table"><tr><td><code>contrast</code></td><td><strong>Description</strong></td><td><strong>Formula</strong></td></tr><tr><td><code>"diff"</code>/<code>"rd"</code></td><td>Mean/risk difference</td><td><code>E[Y(1)] - E[Y(0)]</code></td></tr><tr><td><code>"rr"</code>/<code>"irr"</code></td><td>Risk ratio/incidence rate ratio</td><td><code>E[Y(1)] / E[Y(0)]</code></td></tr><tr><td><code>"sr"</code></td><td>Survival ratio</td><td><code>(1 - E[Y(1)]) / (1 - E[Y(0)])</code></td></tr><tr><td><code>"srr"</code>/<code>"grrr"</code></td><td>Switch risk ratio</td><td><code>1 - sr</code> if <code>E[Y(1)] &gt; E[Y(0)]</code></td></tr><tr><td></td><td></td><td><code>rr - 1</code> if <code>E[Y(1)] &lt; E[Y(0)]</code></td></tr><tr><td></td><td></td><td><code>0</code> otherwise</td></tr><tr><td><code>"or"</code></td><td>Odds ratio</td><td><code>O[Y(1)] / O[Y(0)]</code></td></tr><tr><td></td><td></td><td>where <code>O[Y(.)]</code> = <code>E[Y(.)] / (1 - E[Y(.)])</code></td></tr><tr><td><code>"nnt"</code></td><td>Number needed to treat</td><td><code>1 / rd</code></td></tr></table><p>The <code>log(.)</code> versions are defined by taking the <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code> (natural log) of the
corresponding effect measure.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="sim_apply.html">sim_apply()</a></code>, which provides a general interface to computing any quantities for simulation-based inference; <code><a href="summary.clarify_est.html">plot.clarify_est()</a></code> for plotting the output of a call to <code>sim_ame()</code>; <code><a href="summary.clarify_est.html">summary.clarify_est()</a></code> for computing p-values and confidence intervals for the estimated quantities.</p>
<p><code><a href="https://marginaleffects.com/man/r/predictions.html" class="external-link">marginaleffects::avg_predictions()</a></code>, <code><a href="https://marginaleffects.com/man/r/comparisons.html" class="external-link">marginaleffects::avg_comparisons()</a></code> and <code><a href="https://marginaleffects.com/man/r/slopes.html" class="external-link">marginaleffects::avg_slopes()</a></code> for delta method-based implementations of computing average marginal effects.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"MatchIt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit the model</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">re78</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span></span></span>
<span class="r-in"><span>             <span class="va">married</span> <span class="op">+</span> <span class="va">re74</span>,</span></span>
<span class="r-in"><span>           data <span class="op">=</span> <span class="va">lalonde</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate coefficients</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim.html">sim</a></span><span class="op">(</span><span class="va">fit</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Average marginal effect of `age`</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"age"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate    2.5 %   97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)] -0.00695 -0.00990 -0.00379</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Contrast between average adjusted predictions</span></span></span>
<span class="r-in"><span><span class="co"># for `treat`</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"treat"</span>, contrast <span class="op">=</span> <span class="st">"rr"</span>,</span></span>
<span class="r-in"><span>               verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Estimate 2.5 % 97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(0)]    0.743 0.695  0.780</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(1)]    0.810 0.742  0.847</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RR         1.090 0.986  1.186</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Average adjusted predictions for `race`; need to follow up</span></span></span>
<span class="r-in"><span><span class="co"># with contrasts for specific levels</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"race"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">est</span>,</span></span>
<span class="r-in"><span>                 `RR(h,b)` <span class="op">=</span> <span class="va">`E[Y(hispan)]`</span> <span class="op">/</span> <span class="va">`E[Y(black)]`</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate 2.5 % 97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(black)]     0.706 0.628  0.778</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(hispan)]    0.832 0.717  0.913</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(white)]     0.800 0.756  0.841</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RR(h,b)         1.178 1.011  1.335</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Average adjusted predictions for `treat` within levels of</span></span></span>
<span class="r-in"><span><span class="co"># `married`, first using `subset` and then using `by`</span></span></span>
<span class="r-in"><span><span class="va">est0</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"treat"</span>, subset <span class="op">=</span> <span class="va">married</span> <span class="op">==</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                contrast <span class="op">=</span> <span class="st">"rd"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est0</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est0</span><span class="op">)</span>, <span class="st">"|married=0"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">est1</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"treat"</span>, subset <span class="op">=</span> <span class="va">married</span> <span class="op">==</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                contrast <span class="op">=</span> <span class="st">"rd"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est1</span><span class="op">)</span>, <span class="st">"|married=1"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">est0</span>, <span class="va">est1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Estimate   2.5 %  97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(0)]|married=0   0.7241  0.6669  0.7777</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(1)]|married=0   0.7952  0.7243  0.8367</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RD|married=0        0.0711 -0.0102  0.1399</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(0)]|married=1   0.7697  0.6972  0.8104</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(1)]|married=1   0.8308  0.7256  0.8774</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RD|married=1        0.0610 -0.0104  0.1232</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"treat"</span>, by <span class="op">=</span> <span class="op">~</span><span class="va">married</span>,</span></span>
<span class="r-in"><span>               contrast <span class="op">=</span> <span class="st">"rd"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">est</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A `clarify_est` object (from `sim_ame()`)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Average adjusted predictions for `treat`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    - within levels of `married`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - 100 simulated values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - 6 quantities estimated:                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[Y(0)|0] 0.7241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[Y(1)|0] 0.7952</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  RD[0]     0.0711</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[Y(0)|1] 0.7697</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[Y(1)|1] 0.8308</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  RD[1]     0.0610</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Estimate   2.5 %  97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(0)|0]   0.7241  0.6669  0.7777</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(1)|0]   0.7952  0.7243  0.8367</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RD[0]       0.0711 -0.0102  0.1399</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(0)|1]   0.7697  0.6972  0.8104</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[Y(1)|1]   0.8308  0.7256  0.8774</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RD[1]       0.0610 -0.0104  0.1232</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Average marginal effect of `age` within levels of</span></span></span>
<span class="r-in"><span><span class="co"># married*race</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="st">"age"</span>, by <span class="op">=</span> <span class="op">~</span><span class="va">married</span> <span class="op">+</span> <span class="va">race</span>,</span></span>
<span class="r-in"><span>               verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">est</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A `clarify_est` object (from `sim_ame()`)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Average marginal effect of `age`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    - within levels of `married` and `race`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - 100 simulated values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - 6 quantities estimated:                                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[dY/d(age)|0,black]  -0.007950</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[dY/d(age)|0,hispan] -0.005600</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[dY/d(age)|0,white]  -0.006626</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[dY/d(age)|1,black]  -0.008058</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[dY/d(age)|1,hispan] -0.005498</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[dY/d(age)|1,white]  -0.006304</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span>, null <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       Estimate    2.5 %   97.5 % P-value    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)|0,black]  -0.00795 -0.01174 -0.00425  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)|0,hispan] -0.00560 -0.00967 -0.00243  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)|0,white]  -0.00663 -0.00947 -0.00343  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)|1,black]  -0.00806 -0.01197 -0.00439  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)|1,hispan] -0.00550 -0.00941 -0.00239  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> E[dY/d(age)|1,white]  -0.00630 -0.00984 -0.00344  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Comparing AMEs between married and unmarried for</span></span></span>
<span class="r-in"><span><span class="co"># each level of `race`</span></span></span>
<span class="r-in"><span><span class="va">est_diff</span> <span class="op">&lt;-</span> <span class="va">est</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">-</span> <span class="va">est</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est_diff</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"AME_diff|"</span>, <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">race</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est_diff</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  Estimate     2.5 %    97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AME_diff|black  -0.000108 -0.001240  0.001003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AME_diff|hispan  0.000102 -0.001207  0.001409</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AME_diff|white   0.000323 -0.001013  0.001567</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Average adjusted predictions at a combination of `treat`</span></span></span>
<span class="r-in"><span><span class="co"># and `married`</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"treat"</span>, <span class="st">"married"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">est</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A `clarify_est` object (from `sim_ame()`)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Average adjusted predictions for `treat` and `married`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - 100 simulated values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - 4 quantities estimated:                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[Y(0,0)] 0.7374</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[Y(1,0)] 0.8055</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[Y(0,1)] 0.7518</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  E[Y(1,1)] 0.8171</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Average marginal effect of `age` setting `married` to 1</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">sim_ame</span><span class="op">(</span><span class="va">s</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"age"</span>, married <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer, Steven Worthington, Stefano Iacus, Gary King.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

